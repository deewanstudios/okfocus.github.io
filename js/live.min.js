/**
 * Copyright (C) 2013 by Evan You
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */function clamp(e,t,n){return Math.min(Math.max(e,t),n)}function init(){mobile?$("html").addClass("mobile"):$("html").addClass("desktop"),$("body,html").nodoubletapzoom(),scene=(new MX.Scene).addTo("#pano-rapper"),scene.width=window.innerWidth,scene.height=window.innerHeight,scene.perspective=750,window.onresize=function(){scene.width=window.innerWidth,scene.height=window.innerHeight},bind(),mobile?load("mobile"):load("desktop"),animate()}function load(e){cube=cubes[e],spinner&&spinner.stop(),spinner=(new Spinner(spinOpts)).spin(scene.el);var t=mobile?0:3,n=1500-t,r=750-t;skybox&&(scene.remove(skybox),skybox.cancel(),skybox.removeElement()),mobile?skybox=new MX.TexturedBox({width:n,height:n,depth:n,classname:"cubeface",texture:cube.texture,prefix:cube.prefix,overlap:t,onLoad:function(){spinner.stop(),setTimeout(function(){focus(cube),fadein()},0)}}):(skybox=new MX.TexturedBox({width:n,height:n,depth:n,classname:"cubeface",texture:cube.texture,prefix:cube.prefix,overlap:t,onLoad:function(){spinner.stop(),setTimeout(function(){focus(cube),fadein()},0)}}),skybox.rotationY=90,textbox=new MX.TexturedBox({width:r,height:r,depth:r,classname:"cubeface",texture:cube.textTexture,prefix:cube.prefix,overlap:0}),textbox2=new MX.TexturedBox({width:r-10,height:r-10,depth:r-10,classname:"cubeface",texture:cube.text2Texture,prefix:cube.prefix,overlap:0}),scene.add(textbox),scene.add(textbox2)),cube.prefix="",skybox.el.style.opacity=0,scene.add(skybox),mobile&&is_portrait?is_ipad?scene.perspective=cube.perspective:scene.perspective=cube.perspective:mobile&&is_ipad?scene.perspective=cube.perspective*1.4:mobile?scene.perspective=cube.perspective:scene.perspective=cube.perspective,controls.upperBoundX=MX.toRad(cube.upperBoundX)||1e-4,controls.lowerBoundX=MX.toRad(cube.lowerBoundX)||1e-4}function bind(){mobile?controls=bind_mobile():controls=bind_desktop();var e=mobile?"tap":"click"}function bind_mobile(){return controls=new MX.GyroRotationControl,controls.init(),controls}function bind_desktop(){return controls=new MX.RotationControl,controls.sensitivity=.15,controls.ease=12,controls.upperBoundX=.001,controls.lowerBoundX=.001,controls.init(scene.camera),controls}function animate(){requestAnimationFrame(animate),TWEEN.update(),mobile||(textbox.rotationY+=MX.toRad(1/60),textbox2.rotationY-=MX.toRad(1/60)),skybox.rotationY+=MX.toRad(1/120),controls.update(),scene.update()}function focus(e){scene.camera.rotationX=0,scene.camera.rotationY=0;if(!firstTime){scene.camera.rotationX=controls.rotationX=MX.toRad(e.rotationX),scene.camera.rotationY=controls.rotationY=MX.toRad(e.rotationY);return}firstTime=!0,controls.lock(),scene.camera.rotationY=MX.toRad(e.rotationY+270),scene.update(),(new TWEEN.Tween(scene.camera)).to({rotationX:MX.toRad(e.rotationX),rotationY:MX.toRad(e.rotationY)},1500).easing(TWEEN.Easing.Exponential.Out).onComplete(function(){scene.camera.rotationX=controls.rotationX=MX.toRad(e.rotationX),scene.camera.rotationY=controls.rotationY=MX.toRad(e.rotationY),controls.unlock(),mobile&&checkMode()}).start()}function fadein(){(new TWEEN.Tween(skybox.el.style)).to({opacity:1},800).easing(TWEEN.Easing.Linear.None).start()}function spin(e){controls.lock(),(new TWEEN.Tween(skybox)).to({rotationY:Math.PI*2*2.6},3e3).easing(TWEEN.Easing.Exponential.InOut).onComplete(function(){controls.unlock(),mobile&&checkMode()}).start()}function log(){var e="",t=arguments.length;for(var n=0;n<t;n++)e+=arguments[n]+(n===t-1?"":", ");document.getElementById("log").textContent=e}function checkMode(){is_portrait=window.innerWidth<window.innerHeight,is_portrait&&(lastAlpha=0)}var MX=MX||function(e){function c(){var e=document.body.style;t.prefix="webkitTransform"in e?"webkit":"mozTransform"in e?"moz":"msTransform"in e?"ms":"",r=t.transformProp=g("transform"),i=t.transitionProp=g("transition"),s=t.transformOriginProp=g("transformOrigin"),o=t.transformStyleProp=g("transformStyle"),u=t.perspectiveProp=g("perspective"),a=t.transitionEndEvent=t.prefix==="webkit"?"webkitTransitionEnd":"transitionend";var n=["webkit","moz","ms"];for(var f=0;f<n.length&&!window.requestAnimationFrame;++f)window.requestAnimationFrame=window[n[f]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[f]+"CancelAnimationFrame"]||window[n[f]+"CancelRequestAnimationFrame"];l=document.createElement("style"),l.type="text/css",l.innerHTML=".mx-object3d {position: absolute;top: 50%;left: 50%;}",h()}function h(){document.head.appendChild(l)}function p(){document.head.removeChild(l)}function d(e){return e/Math.PI*180}function v(e){return e/180*Math.PI}function m(e){var t=e.rotationOrigin;if(!t)return;var n=t.x-e.x,r=-(t.y-e.y),i=-(t.z-e.z);return{before:"translate3d("+n+"px,"+r+"px,"+i+"px) ",after:"translate3d("+ -n+"px,"+ -r+"px,"+ -i+"px) "}}function g(e){return t.prefix&&(e=t.prefix+e.charAt(0).toUpperCase()+e.slice(1)),e}function y(t){this.setupDomElement(t),this.setCSSTransformStyle("preserve-3d"),this.el.classList.add("mx-object3d"),this.parent=e,this.children=[],this.updateChildren=!0,this.inverseLookAt=!1,this.reset();var n,r,i=this;Object.defineProperty(this,"width",{get:function(){return n||parseInt(i.el.style.width,10)||0},set:function(e){n=e,this.el.style.width=n+"px"}}),Object.defineProperty(this,"height",{get:function(){return r||parseInt(i.el.style.height,10)||0},set:function(e){r=e,this.el.style.height=r+"px"}})}function b(e){var t=this,n=function(){t.call(this),e.init&&e.init.apply(this,arguments)};n.prototype=Object.create(t.prototype);for(var r in e)e.hasOwnProperty(r)&&r!=="init"&&(n.prototype[r]=e[r]);return n.extend=b.bind(n),n}var t={version:"0.1.0",prefix:e,rotationUnit:"rad"},n=5,r,i,s,o,u,a,f=!0,l;return document.addEventListener("DOMContentLoaded",c),y.prototype={constructor:y,reset:function(){this.x=this.__x=0,this.y=this.__y=0,this.z=this.__z=0,this.rotationX=this.__rotationX=0,this.rotationY=this.__rotationY=0,this.rotationZ=this.__rotationZ=0,this.scaleX=this.__scaleX=1,this.scaleY=this.__scaleY=1,this.scaleZ=this.__scaleZ=1,this.scale=this.__scale=1,this.perspective=this.__perspective=0,this.rotationOrigin=e,this.followTarget=e,this.dirty=!0,this.update()},setupDomElement:function(t){this.el=e;if(t instanceof HTMLElement)this.el=t;else if(typeof t=="string"){var n=t.match(/^[^.#\s]*/)[1],r=t.match(/#[^.#\s]*/),i=t.match(/\.[^.#\s]*/g);this.el=document.createElement(n||"div"),r&&(this.el.id=r[0].slice(1));if(i){var s=i.length;while(s--)this.el.classList.add(i[s].slice(1))}}else this.el=document.createElement("div")},update:function(){if(this.updateChildren){var e=this.children.length;while(e--)this.children[e].update()}this.followTarget&&this.lookAt(this.followTarget,!1);if(this.scaleX!==this.__scaleX||this.scaleY!==this.__scaleY||this.scaleZ!==this.__scaleZ)this.__scaleX=this.scaleX,this.__scaleY=this.scaleY,this.__scaleZ=this.scaleZ,this.dirty=!0;this.scale!==this.__scale&&(this.scaleX=this.scaleY=this.scaleZ=this.__scaleX=this.__scaleY=this.__scaleZ=this.__scale=this.scale,this.dirty=!0);if(this.rotationX!==this.__rotationX||this.rotationY!==this.__rotationY||this.rotationZ!==this.__rotationZ)this.__rotationX=this.rotationX,this.__rotationY=this.rotationY,this.__rotationZ=this.rotationZ,this.dirty=!0;if(this.x!==this.__x||this.y!==this.__y||this.z!==this.__z)this.__x=this.x,this.__y=this.y,this.__z=this.z,this.dirty=!0;this.perspective!==this.__perspective&&(this.__perspective=this.perspective,this.dirty=!0);if(this.dirty&&this.el){var i=m(this),s="rotateX("+this.rotationX.toFixed(n)+t.rotationUnit+") "+"rotateY("+this.rotationY.toFixed(n)+t.rotationUnit+") "+"rotateZ("+this.rotationZ.toFixed(n)+t.rotationUnit+") ",o=(t.positionAtCenter?"translate3d(-50%, -50%, 0) ":"")+(this.perspective?"perspective("+this.perspective+"px) ":"")+"translate3d("+this.x.toFixed(n)+"px,"+(-this.y).toFixed(n)+"px,"+(-this.z).toFixed(n)+"px) "+"scale3d("+this.scaleX.toFixed(n)+","+this.scaleY.toFixed(n)+","+this.scaleZ.toFixed(n)+") ";i?o+=i.before+s+i.after:o+=s,this.el.style[r]=o,this.dirty=!1}return this},lookAt:function(e,t){var n=this.getLookAtEuler(e);return this.setRotation(n),t!==!1&&this.update(),this},getLookAtEuler:function(e){var n={},r=e.x-this.x,i=e.y-this.y,s=e.z-this.z;this.inverseLookAt&&(r=-r,i=-i,s=-s),s===0&&(s=.001),n.x=-Math.atan2(i,s);var o=s>0?1:-1;return n.y=o*Math.atan2(r*Math.cos(n.x),s*-o),n.z=Math.atan2(Math.cos(n.x),Math.sin(n.x)*Math.sin(n.y))-Math.PI/2,t.rotationUnit==="deg"&&(n.x=d(n.x),n.y=d(n.y),n.z=d(n.z)),n},add:function(){if(!this.el)return;var e=this;return Array.prototype.forEach.call(arguments,function(t){if(!t instanceof y)return;e.el.appendChild(t.el),e.children||(e.children=[]),e.children.push(t),t.parent=e}),this},remove:function(){var t=this;return Array.prototype.forEach.call(arguments,function(n){var r=t.children.indexOf(n);r!==-1&&(t.children.splice(r,1),n.parent=e)}),this},addTo:function(e){return typeof e=="string"&&(e=document.querySelector(e)),e instanceof HTMLElement&&e.appendChild?e.appendChild(this.el):(e instanceof y||e instanceof Scene)&&e.add(this),this},removeElement:function(){this.el.parentNode&&this.el.parentNode.removeChild(this.el)},setPosition:function(e){this.x=e.x||e.x===0?e.x:this.x,this.y=e.y||e.y===0?e.y:this.y,this.z=e.z||e.z===0?e.z:this.z},setRotation:function(e){this.rotationX=e.x||e.x===0?e.x:this.rotationX,this.rotationY=e.y||e.y===0?e.y:this.rotationY,this.rotationZ=e.z||e.z===0?e.z:this.rotationZ},setScale:function(e){this.scaleX=e.x||e.x===0?e.x:this.scaleX,this.scaleY=e.y||e.y===0?e.y:this.scaleY,this.scaleZ=e.z||e.z===0?e.z:this.scaleZ},setCSSTransformOrigin:function(e){return this.el&&(this.el.style[s]=e),this},setCSSTransformStyle:function(e){return this.el&&(this.el.style[o]=e),this},setCSSTransition:function(e){return this.el&&(this.el.style[i]=e),this},setCSSPerspective:function(e){return this.el&&(this.el.style[u]=e),this},onTransitionEnd:function(e){function n(){t.removeEventListener(a,n),e()}this.cancelTransitionEnd();var t=this.el;t.addEventListener(a,n)},cancelTransitionEnd:function(){this.el.removeEventListener(a)}},y.extend=b.bind(y),t.Object3D=y,t.toRad=v,t.toDeg=d,Object.defineProperty(t,"positionAtCenter",{get:function(){return f},set:function(e){if(typeof e!="boolean")return;f=e,f?h():p()}}),t}();MX.GyroRotationControl=function(){var e=!1,t;return{rotationX:0,rotationY:0,init:function(){window.addEventListener("orientationchange",checkMode);var e=0,n=0,r=0,i=0,s=120;window.addEventListener("devicemotion",function(t){if(!is_portrait)return;var n=t.rotationRate.alpha;e+=n,i+=1},!1),window.addEventListener("deviceorientation",function(o){t||(t=o.alpha);var u=0,a=0;if(is_portrait){var f;o.webkitCompassHeading?f=180-o.webkitCompassHeading:f=180-o.alpha,is_android&&(f=360-f),o.beta>r&&(r=o.beta,n=e);var l=o.beta+7;!is_android&&i>s?u=e>n?o.beta-90:90-o.beta:u=0;if(Math.abs(f-t)<100||Math.abs(f-t)>300)a=f-t,t=f;a>300?a-=360:a<-300&&(a+=360),controls.rotationX=clamp(MX.toRad(u),controls.lowerBoundX,controls.upperBoundX),controls.rotationY+=MX.toRad(a)}else u=o.gamma>0?90-o.gamma:90+o.gamma,a=o.alpha-t,t=o.alpha,a>300?a-=360:a<-300&&(a+=360),controls.rotationX=clamp(MX.toRad(u),controls.lowerBoundX,controls.upperBoundX),controls.rotationY+=MX.toRad(a)}),document.addEventListener("touchmove",function(e){e.preventDefault()})},update:function(){if(e)return;var t=scene.camera;t.rotationX+=(this.rotationX-t.rotationX)/6,t.rotationY+=(this.rotationY-t.rotationY)/6},lock:function(){e=!0},unlock:function(){e=!1}}},MX.RotationControl=function(){function c(t,n){if(r)return;e=t,a.rotationX=e.rotationX,a.rotationY=e.rotationY,n instanceof HTMLElement?listener=n:n instanceof MX.Object3D?listener=n.el:listener=window.document,listener.addEventListener("mousedown",v),listener.addEventListener("mousemove",m),listener.addEventListener("mouseup",g),listener.addEventListener("touchstart",v),listener.addEventListener("touchmove",m),listener.addEventListener("touchend",g),r=!0}function h(t){e=t,a.rotationX=e.rotationX,a.rotationY=e.rotationY}function p(t){d(),r=!1,c(e,t),pointerLockEnabled&&y()}function d(){if(!r)return;listener.removeEventListener("mousedown",v),listener.removeEventListener("mousemove",m),listener.removeEventListener("mouseup",g),listener.removeEventListener("touchstart",v),listener.removeEventListener("touchmove",m),listener.removeEventListener("touchend",g),u&&(document.removeEventListener(o+"pointerlockchange",b),document.removeEventListener("mousemove",w),document.body[o+(o?"E":"e")+"xitPointerLock"]()),r=!1}function v(e){e=E(e);if(!e)return;e.preventDefault(),n=!0,i=e.pageX,s=e.pageY}function m(e){e.preventDefault();if(a.drag&&!n)return;e=E(e);if(!e)return;i=i||e.pageX,s=s||e.pageY;var t=e.pageX-i,r=e.pageY-s;i=e.pageX,s=e.pageY,S(t,r)}function g(e){e.preventDefault(),n=!1}function y(){if(pointerLockEnabled)return;document.addEventListener(o+"pointerlockchange",b),document.addEventListener("mousemove",w),document.body[o+(o?"R":"r")+"equestPointerLock"]()}function b(){var e=document.body;document[o+(o?"P":"p")+"ointerLockElement"]===e?pointerLockEnabled=!0:pointerLockEnabled=!1}function w(e){if(!pointerLockEnabled)return;var t=e[o+(o?"M":"m")+"ovementX"],n=e[o+(o?"M":"m")+"ovementY"];S(t,n)}function E(e){return e.touches?e.touches.length>1?!1:e.touches[0]:e}function S(e,t){a.inverseX&&(e=-e),a.inverseY&&(t=-t),MX.rotationUnit!=="deg"&&(e=MX.toRad(e),t=MX.toRad(t)),a.disableX||(a.rotationX-=t*a.sensitivity,a.upperBoundX&&(a.rotationX=Math.min(a.rotationX,a.upperBoundX)),a.lowerBoundX&&(a.rotationX=Math.max(a.rotationX,a.lowerBoundX))),a.disableY||(a.rotationY+=e*a.sensitivity,a.upperBoundY&&(a.rotationY=Math.min(a.rotationY,a.upperBoundY)),a.lowerBoundY&&(a.rotationY=Math.max(a.rotationY,a.lowerBoundY)))}function x(){if(!e||t)return;var n=a.rotationX-e.rotationX,r=a.rotationY-e.rotationY;Math.abs(n)<1e-4?e.rotationX=a.rotationX:e.rotationX+=n/a.ease,Math.abs(r)<1e-4?e.rotationY=a.rotationY:e.rotationY+=r/a.ease}function T(){t=!0}function N(){a.rotationX=e.rotationX,a.rotationY=e.rotationY,t=!1}var e,t=!1,n=!1,r=!1,i,s,o="pointerLockElement"in document?"":"mozPointerLockElement"in document?"moz":"webkitPointerLockElement"in document?"webkit":null,u=o!==null;pointerLockEnabled=!1;var a={sensitivity:.5,ease:10,drag:!0,inverseX:!1,inverseY:!1,disableX:!1,disableY:!1,rotationX:0,rotationY:0,upperBoundX:undefined,lowerBoundX:undefined,upperBoundY:undefined,lowerBoundY:undefined,usePreset:function(e){var t=l[e];if(t){f&&l[f].teardown&&l[f].teardown();for(var n in t)n!=="setup"&&n!=="teardown"&&(a[n]=t[n]);n.setup&&t.setup()}}},f,l={firstPerson:{drag:!1,ease:2,sensitivity:.18,inverseX:!0,inverseY:!0,upperBoundX:MX.rotationUnit==="deg"?90:Math.PI/2,lowerBoundX:MX.rotationUnit==="deg"?-90:-Math.PI/2},skybox:{sensitivity:.18,inverseX:!0,inverseY:!0,upperBoundX:MX.rotationUnit==="deg"?90:Math.PI/2,lowerBoundX:MX.rotationUnit==="deg"?-90:-Math.PI/2}};return a.init=c,a.remove=d,a.update=x,a.lock=T,a.unlock=N,a.initPointerLock=y,a.changeObject=h,a.changeListener=p,a},MX.TexturedBox=MX.Object3D.extend({init:function(e){if(!e.width||!e.height||!e.depth||!e.texture&&!e.classname){console.warn("TextureBox: missing arguments");return}var t=MX.rotationUnit==="deg"?90:Math.PI/2,n=e.offset?e.offset.x||0:0,r=e.offset?e.offset.y||0:0,i=e.overlap?e.overlap:0,s=typeof e.texture=="object";if(e.prefix&&s)for(var o in e.texture)e.texture[o]=e.prefix+e.texture[o];else e.prefix&&(e.texture=e.prefix+e.texture);e.onLoad&&(this.loader=new Loader(e.onLoad),this.loader.preloadImages(e.texture));var u=this.top=new MX.Object3D;u.width=e.width,u.height=e.depth,u.rotationX=t,u.y=e.height/2-i,s||(u.el.style.backgroundPosition=-(n+e.depth)+"px "+(-r+"px"));var a=this.bottom=new MX.Object3D;a.width=e.width,a.height=e.depth,a.rotationX=-t,a.y=-e.height/2+i,s||(a.el.style.backgroundPosition=-(n+e.depth+e.width)+"px "+(-r+"px"));var f=this.left=new MX.Object3D;f.width=e.depth,f.height=e.height,f.rotationY=-t,f.x=-e.width/2+i,s||(f.el.style.backgroundPosition=-n+"px "+(-(r+e.depth)+"px"));var l=this.right=new MX.Object3D;l.width=e.depth,l.height=e.height,l.rotationY=t,l.x=e.width/2-i,s||(l.el.style.backgroundPosition=-(n+e.depth+e.width)+"px "+(-(r+e.depth)+"px"));var c=this.front=new MX.Object3D;c.width=e.width,c.height=e.height,c.z=-e.depth/2+i,s||(c.el.style.backgroundPosition=-(n+e.depth)+"px "+(-(r+e.depth)+"px"));var h=this.back=new MX.Object3D;h.width=e.width,h.height=e.height,h.rotationY=t*2,h.z=e.depth/2-i,s||(h.el.style.backgroundPosition=-(n+e.depth*2+e.width)+"px "+(-(r+e.depth)+"px")),this.add(u,a,f,l,c,h),this.children.forEach(function(t,n){s?t.el.innerHTML="<img src='"+e.texture[n]+"' width='100%' height='100%'>":e.texture&&(t.el.style.backgroundImage="url("+e.texture+")"),e.classname&&t.el.classList.add(e.classname),t.el.style.backgroundRepeat="no-repeat"}),this.update(),this.updateChildren=!1},cancel:function(){this.loader&&(this.loader.readyCallback=function(){})}}),MX.Scene=function(){function n(){this.el=document.createElement("div"),this.el.classList.add("mx-scene");var e=this.el.style;e[MX.transformProp]="preserve-3d",e.webkitPerspectiveOrigin="50% 50%",e.mozPerspectiveOrigin="50% 50%",e.perspectiveOrigin="50% 50%",e.webkitUserSelect="none",e.mozUserSelect="none",e.userSelect="none",e.overflow="hidden",this.inner=(new MX.Object3D).addTo(this.el),this.inner.el.style.width="0",this.inner.el.style.height="0";var t=this,n,r,s;Object.defineProperty(this,"width",{get:function(){return n},set:function(e){n=e,t.el.style.width=e+"px"}}),Object.defineProperty(this,"height",{get:function(){return r},set:function(e){r=e,t.el.style.height=e+"px"}}),Object.defineProperty(this,"perspective",{get:function(){return s},set:function(e){s=e,t.el.style[MX.perspectiveProp]=e+"px",t.inner.z=-e-t.camera.z,t.inner.rotationOrigin.z=-e}});var o=this.camera=new MX.Object3D;o.el=null,o.getLookAtEuler=i.bind(o),this.inner.rotationOrigin={x:0,y:0,z:0},this.perspective=0}function i(e){var t=e.x-this.x,n=e.y-this.y,i=e.z-this.z;return r={},r.y=Math.atan2(-t,i),r.x=Math.atan2(-n,Math.sqrt(t*t+i*i)),r.z=0,MX.rotationUnit==="deg"&&(r.x=MX.toDeg(r.x),r.y=MX.toDeg(r.y)),r}var e=MX.Object3D.prototype.add,t=MX.Object3D.prototype.remove;return n.prototype={constructor:n,add:function(){return e.apply(this.inner,arguments),this},remove:function(){return t.apply(this.inner,arguments),this},addTo:function(e){return typeof e=="string"&&(e=document.querySelector(e)),e instanceof HTMLElement&&e.appendChild?e.appendChild(this.el):console.warn("You can only add a Scene to an HTML element."),this},update:function(){var e=this.inner,t=this.camera;return t.update(),e.z=-this.perspective-t.z,e.x=-t.x,e.y=-t.y,e.rotationX=-t.rotationX,e.rotationY=-t.rotationY,e.update(),this}},n}();var Loader=Loader||function(){function e(e){this.assets={},this.images=[],this.readyCallback=e}return e.prototype.register=function(e){this.assets[e]=!1},e.prototype.ready=function(e){window.debug&&console.log("ready >> "+e),this.assets[e]=!0;if(this.loaded)return;if(!this.isReady())return;this.loaded=!0,this.readyCallback&&this.readyCallback()},e.prototype.isReady=function(){for(var e in this.assets)if(this.assets.hasOwnProperty(e)&&this.assets[e]!=1)return!1;return!0},e.prototype.remainingAssets=function(){var e=0;for(var t in this.assets)this.assets.hasOwnProperty(t)&&this.assets[t]!=1&&(e++,console.log("remaining: "+t));return e},e.prototype.preloadImages=function(e){this.register("preload");for(var t=0;t<e.length;t++)this.preloadImage(e[t]);this.ready("preload")},e.prototype.preloadImage=function(e){var t=this;this.register(e);var n=new Image;n.onload=function(){t.ready(e)},n.src=e,n.complete&&n.onload(),t.images.push(n)},e}();"use strict";var TWEEN=TWEEN||function(){var e=[];return{REVISION:"7",getAll:function(){return e},removeAll:function(){e=[]},add:function(t){e.push(t)},remove:function(t){t=e.indexOf(t),-1!==t&&e.splice(t,1)},update:function(t){if(0===e.length)return!1;for(var n=0,r=e.length,t=void 0!==t?t:Date.now();n<r;)e[n].update(t)?n++:(e.splice(n,1),r--);return!0}}}();TWEEN.Tween=function(e){var t={},n={},r=1e3,i=0,s=null,o=TWEEN.Easing.Linear.None,u=TWEEN.Interpolation.Linear,a=[],f=null,l=!1,c=null,h=null;this.to=function(e,t){return null!==t&&(r=t),n=e,this},this.start=function(r){TWEEN.add(this),l=!1,s=void 0!==r?r:Date.now(),s+=i;for(var o in n)if(null!==e[o]){if(n[o]instanceof Array){if(0===n[o].length)continue;n[o]=[e[o]].concat(n[o])}t[o]=e[o]}return this},this.stop=function(){return TWEEN.remove(this),this},this.delay=function(e){return i=e,this},this.easing=function(e){return o=e,this},this.interpolation=function(e){return u=e,this},this.chain=function(){return a=arguments,this},this.onStart=function(e){return f=e,this},this.onUpdate=function(e){return c=e,this},this.onComplete=function(e){return h=e,this},this.update=function(i){if(i<s)return!0;!1===l&&(null!==f&&f.call(e),l=!0);var v=(i-s)/r,v=1<v?1:v,g=o(v),y;for(y in t){var w=t[y],E=n[y];e[y]=E instanceof Array?u(E,g):w+(E-w)*g}null!==c&&c.call(e,g);if(1==v){null!==h&&h.call(e),v=0;for(g=a.length;v<g;v++)a[v].start(i);return!1}return!0}},TWEEN.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return 1>(e*=2)?.5*e*e:-0.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return 1>(e*=2)?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return 1>(e*=2)?.5*e*e*e*e:-0.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return 1>(e*=2)?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:1>(e*=2)?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return 1>(e*=2)?-0.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||1>n?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),-(n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/.4)))},Out:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||1>n?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin((e-t)*2*Math.PI/.4)+1)},InOut:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||1>n?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),1>(e*=2)?-0.5*n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/.4):.5*n*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*2*Math.PI/.4)+1)}},Back:{In:function(e){return e*e*(2.70158*e-1.70158)},Out:function(e){return--e*e*(2.70158*e+1.70158)+1},InOut:function(e){return 1>(e*=2)?.5*e*e*(3.5949095*e-2.5949095):.5*((e-=2)*e*(3.5949095*e+2.5949095)+2)}},Bounce:{In:function(e){return 1-TWEEN.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return.5>e?.5*TWEEN.Easing.Bounce.In(2*e):.5*TWEEN.Easing.Bounce.Out(2*e-1)+.5}}},TWEEN.Interpolation={Linear:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),s=TWEEN.Interpolation.Utils.Linear;return 0>t?s(e[0],e[1],r):1<t?s(e[n],e[n-1],n-r):s(e[i],e[i+1>n?n:i+1],r-i)},Bezier:function(e,t){var n=0,r=e.length-1,i=Math.pow,s=TWEEN.Interpolation.Utils.Bernstein,o;for(o=0;o<=r;o++)n+=i(1-t,r-o)*i(t,o)*e[o]*s(r,o);return n},CatmullRom:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),s=TWEEN.Interpolation.Utils.CatmullRom;return e[0]===e[n]?(0>t&&(i=Math.floor(r=n*(1+t))),s(e[(i-1+n)%n],e[i],e[(i+1)%n],e[(i+2)%n],r-i)):0>t?e[0]-(s(e[0],e[0],e[1],e[1],-r)-e[0]):1<t?e[n]-(s(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):s(e[i?i-1:0],e[i],e[n<i+1?n:i+1],e[n<i+2?n:i+2],r-i)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=TWEEN.Interpolation.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:function(){var e=[1];return function(t){var n=1,r;if(e[t])return e[t];for(r=t;1<r;r--)n*=r;return e[t]=n}}(),CatmullRom:function(e,t,n,r,i){var e=.5*(n-e),r=.5*(r-t),s=i*i;return(2*t-2*n+e+r)*i*s+(-3*t+3*n-2*e-r)*s+e*i+t}}},function(e){var t=/iphone|ipad/i.test(navigator.userAgent);e.fn.nodoubletapzoom=function(){return t&&e(this).bind("touchstart",function(n){var r=n.timeStamp,i=e(this).data("lastTouch")||r,s=r-i,o=n.originalEvent.touches.length;e(this).data("lastTouch",r);if(!s||s>500||o>1)return;n.preventDefault(),e(this).trigger("click").trigger("click")}),this}}(jQuery),function(e,t){typeof exports=="object"?module.exports=t():typeof define=="function"&&define.amd?define(t):e.Spinner=t()}(this,function(){"use strict";function r(e,t){var n=document.createElement(e||"div"),r;for(r in t)n[r]=t[r];return n}function i(e){for(var t=1,n=arguments.length;t<n;t++)e.appendChild(arguments[t]);return e}function o(e,r,i,o){var u=["opacity",r,~~(e*100),i,o].join("-"),a=.01+i/o*100,f=Math.max(1-(1-e)/r*(100-a),e),l=n.substring(0,n.indexOf("Animation")).toLowerCase(),c=l&&"-"+l+"-"||"";return t[u]||(s.insertRule("@"+c+"keyframes "+u+"{"+"0%{opacity:"+f+"}"+a+"%{opacity:"+e+"}"+(a+.01)+"%{opacity:1}"+(a+r)%100+"%{opacity:"+e+"}"+"100%{opacity:"+f+"}"+"}",s.cssRules.length),t[u]=1),u}function u(t,n){var r=t.style,i,s;n=n.charAt(0).toUpperCase()+n.slice(1);for(s=0;s<e.length;s++){i=e[s]+n;if(r[i]!==undefined)return i}if(r[n]!==undefined)return n}function a(e,t){for(var n in t)e.style[u(e,n)||n]=t[n];return e}function f(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]===undefined&&(e[r]=n[r])}return e}function l(e){var t={x:e.offsetLeft,y:e.offsetTop};while(e=e.offsetParent)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}function c(e,t){return typeof e=="string"?e:e[t%e.length]}function p(e){if(typeof this=="undefined")return new p(e);this.opts=f(e||{},p.defaults,h)}function d(){function e(e,t){return r("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',t)}s.addRule(".spin-vml","behavior:url(#default#VML)"),p.prototype.lines=function(t,n){function o(){return a(e("group",{coordsize:s+" "+s,coordorigin:-r+" "+ -r}),{width:s,height:s})}function h(t,s,u){i(f,i(a(o(),{rotation:360/n.lines*t+"deg",left:~~s}),i(a(e("roundrect",{arcsize:n.corners}),{width:r,height:n.width,left:n.radius,top:-n.width>>1,filter:u}),e("fill",{color:c(n.color,t),opacity:n.opacity}),e("stroke",{opacity:0}))))}var r=n.length+n.width,s=2*r,u=-(n.width+n.length)*2+"px",f=a(o(),{position:"absolute",top:u,left:u}),l;if(n.shadow)for(l=1;l<=n.lines;l++)h(l,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(l=1;l<=n.lines;l++)h(l);return i(t,f)},p.prototype.opacity=function(e,t,n,r){var i=e.firstChild;r=r.shadow&&r.lines||0,i&&t+r<i.childNodes.length&&(i=i.childNodes[t+r],i=i&&i.firstChild,i=i&&i.firstChild,i&&(i.opacity=n))}}var e=["webkit","Moz","ms","O"],t={},n,s=function(){var e=r("style",{type:"text/css"});return i(document.getElementsByTagName("head")[0],e),e.sheet||e.styleSheet}(),h={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};p.defaults={},f(p.prototype,{spin:function(e){this.stop();var t=this,i=t.opts,s=t.el=a(r(0,{className:i.className}),{position:i.position,width:0,zIndex:i.zIndex}),o=i.radius+i.length+i.width,u,f;e&&(e.insertBefore(s,e.firstChild||null),f=l(e),u=l(s),a(s,{left:(i.left=="auto"?f.x-u.x+(e.offsetWidth>>1):parseInt(i.left,10)+o)+"px",top:(i.top=="auto"?f.y-u.y+(e.offsetHeight>>1):parseInt(i.top,10)+o)+"px"})),s.setAttribute("role","progressbar"),t.lines(s,t.opts);if(!n){var c=0,h=(i.lines-1)*(1-i.direction)/2,p,d=i.fps,v=d/i.speed,m=(1-i.opacity)/(v*i.trail/100),g=v/i.lines;(function y(){c++;for(var e=0;e<i.lines;e++)p=Math.max(1-(c+(i.lines-e)*g)%v*m,i.opacity),t.opacity(s,e*i.direction+h,p,i);t.timeout=t.el&&setTimeout(y,~~(1e3/d))})()}return t},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=undefined),this},lines:function(e,t){function l(e,n){return a(r(),{position:"absolute",width:t.length+t.width+"px",height:t.width+"px",background:e,boxShadow:n,transformOrigin:"left",transform:"rotate("+~~(360/t.lines*s+t.rotate)+"deg) translate("+t.radius+"px"+",0)",borderRadius:(t.corners*t.width>>1)+"px"})}var s=0,u=(t.lines-1)*(1-t.direction)/2,f;for(;s<t.lines;s++)f=a(r(),{position:"absolute",top:1+~(t.width/2)+"px",transform:t.hwaccel?"translate3d(0,0,0)":"",opacity:t.opacity,animation:n&&o(t.opacity,t.trail,u+s*t.direction,t.lines)+" "+1/t.speed+"s linear infinite"}),t.shadow&&i(f,a(l("#000","0 0 4px #000"),{top:"2px"})),i(e,i(f,l(c(t.color,s),"0 0 1px rgba(0,0,0,.1)")));return e},opacity:function(e,t,n){t<e.childNodes.length&&(e.childNodes[t].style.opacity=n)}});var v=a(r("group"),{behavior:"url(#default#VML)"});return!u(v,"transform")&&v.adj?d():n=u(v,"animation"),p});var spinOpts={lines:7,length:10,width:4,radius:10,corners:1,rotate:0,direction:1,color:"#000",speed:1.2,trail:58,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},scene,cam,skybox,controls,spinner,mobile="DeviceOrientationEvent"in window&&"ontouchstart"in window&&window.screen.width<=1024,is_portrait=window.innerWidth<window.innerHeight,is_ios6=navigator.userAgent.match(/iPhone OS 6/i),is_android=navigator.userAgent.match(/Android/i),is_ipad=navigator.userAgent.match(/iPad/i),firstTime=!0,index=0,order="desktop".split(" "),url_prefix="http://s3.amazonaws.com/okfocus/pano/office/",cubes={desktop:{title:"OKFocus",prefix:url_prefix,texture:["officebg0004.png","officebg0005.png","officebg0001.png","officebg0003.png","officebg0000.png","officebg0002.png"],textTexture:["blank.png","officetextleft0005.png","officetextleft0001.png","officetextleft0003.png","officetextleft0000.png","officetextleft0002.png"],text2Texture:["blank.png","blank.png","officetextright0001.png","officetextright0003.png","officetextright0000.png","officetextright0002.png"],rotationX:3,rotationY:-40,lowerBoundX:-60,upperBoundX:60,perspective:550,artist:!1},mobile:{title:"OKFocus",prefix:url_prefix,texture:["windows0004.png","windows0005.png","windows0003.png","windows0001.png","windows0000.png","windows0002.png"],rotationX:3,rotationY:-40,lowerBoundX:-60,upperBoundX:60,perspective:550,artist:!1}};